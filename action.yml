name: 'RMD Render Action'
description: 'GitHub Action to render R Markdown documents using rocker/r-rmd'
branding:
  icon: 'book-open'
  color: 'blue'

inputs:
  input_file:
    description: 'Path to the input R Markdown file'
    required: true

outputs:
  output_files:
    description: 'Comma-separated list of rendered output files'

runs:
  using: 'docker'
  image: 'rocker/r-rmd'
  env:
    R_LIBS_USER: '/github/workspace/.cache/R'
  args:
    - -e
    - |
      # 安装依赖包
      if (!requireNamespace("flexdashboard", quietly = TRUE)) {
        install.packages("flexdashboard")
      }
      
      # 渲染文档
      rmarkdown::render("${{ inputs.input_file }}")
      
      # 列出生成的文件
      base_dir <- dirname("${{ inputs.input_file }}")
      base_name <- tools::file_path_sans_ext(basename("${{ inputs.input_file }}"))
      output_files <- list.files(
        path = base_dir,
        pattern = paste0("^", base_name, "\\.(pdf|html|docx)$"),
        full.names = TRUE
      )
      writeLines(sprintf("::set-output name=output_files::%s", 
                        paste(output_files, collapse = ","))) 